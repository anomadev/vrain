Las `**Arrow Functions**` llegaron en **PHP 7.4** ([[1.1 What is PHP]]) como una sintaxis más concisa para definir **funciones anónimas** ([[6.5 Anonymous Functions]]), manteniendo todas sus capacidades pero simplificando la captura de variables del ámbito padre sin necesidad de `use` [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com). Internamente, tanto las `Arrow Functions` como las funciones anónimas se implementan mediante la clase interna `Closure` [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com). Su forma básica es `fn(argument_list) => expresión`, donde **solo una expresión** puede aparecer después de `=>` [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com). Las `Arrow Functions` **capturan automáticamente** las variables usadas del ámbito externo **por valor**, facilitando la escritura de `callbacks` y transformaciones en una sola línea [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com). Aunque son más limitadas (no permiten cuerpo de múltiples sentencias), soportan **parámetros tipados**, **valores por defecto**, **variádicos**, **paso por referencia** y **retorno por referencia** del mismo modo que las `closures` tradicionales [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com). Su característica de **`binding by-value`** impide modificar variables externas, a diferencia de las funciones anónimas con `use(&$var)` [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com). Además, en PHP 8.0 se añadió el **`trailing comma`** en la lista de parámetros de `Arrow Functions` para mejorar el formateo y legibilidad [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com).
### Definición 
Una `Arrow Function` es una función anónima de una sola expresión introducida en PHP 7.4 con la sintaxis:
```php
fn(parameter_list) => expression;
```
Internamente se representa como un objeto `Closure` ([[6.5 Anonymous Functions]]), y capturan automáticamente las variables usadas del ámbito padre por valor.
### Conceptos clave
- Sintaxis
    - `fn($x, $y) => $x + $y;` [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com).
    - **No admite** llaves `{}` ni múltiples sentencias; solo **una expresión** [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com).
- Captura de Variables
    - **Automática y por valor**: cualquier variable del ámbito exterior usada en la expresión se vincula por copia, sin necesidad de `use` [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com).
    - No puede modificar variables externas; para eso, usar `closures` con `use (&$var)` [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com).
- Tipos y Modificadores
    - **Parámetros tipados y valores por defecto**: `fn(int $n = 0): int => $n * 2;` [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com). ([[6.2 Parameters & Return Values]])
    - **Variádicos**: `fn(...$args) => array_sum($args);` [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com). ([[6.9 Variadic Functions]])
    - **Paso por referencia**: `fn(&$x) => $x++;` [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com).
    - **Retorno por referencia**: `fn&($x) => $x;` [PHP](https://www.php.net/manual/en/functions.arrow.php?utm_source=chatgpt.com).
- `Trailing comma`
	- Permitido desde PHP 8.0 en las lista de parámetros, mejorando el formateo vertical:
```php
fn (
	$a,
	$b,
) => $a + $b;
```
- Comparación con `anonymous functions`
	- Se comportan igual que `closures` en cuanto a firma y tipado, pero simplifican la captura de variables externas.
### Ejemplos prácticos
##### Transformación con `array_map`
```php
<?php

$factor = 10;
$nums = [1, 2, 3, 4];
$doubles = array_map(fn($n) => $n * factor, $nums);

print_r($doubles); // [10, 20, 30, 40]

```
##### `Arrow Function` anidada
```php
<?php

$z = 2;
$fn = fn($x) => fn($y) => $x * $y + $z;

echo $fn(3)(4); // 14 (3*4 + 2)

```
##### Parámetros tipados y referencia
```php
<?php

$inc = fn(int &$n): int => ++$n;
$val = 5;

echo $inc($val); // 6
echo $val;       // 6 (por referencia)

```
##### Retorno por referencia
```php
<?php

$refFn = fn&($arr) => $arr[0];
$data = [100];
$ref =& $refFn($data);
$ref = 200;

var_dump($data[0]); // int(200)
```
##### Uso de `trailing comma`
```php
<?php

$sum = fn(
	$a,
	$b,
) => $a + $b;

echo $sum(2, 3); // 5
```
