PHP ofrece un conjunto de funciones y métodos naticos para procesar archivos CSV de forma fiable y eficiente. 
Para leer CSV se usan `fgetcsv()` en flujos `fopen` o `SplFileObject::fgetcsv()` en objetos `SplFileObject`, que parsean líneas en `arrays` ([[3.1 Arrays]]) respetando delimitadores, comillas y escapes.
Para escribir, `fputcsv()` junto con `fopen()` o `SplFileObject::fputcsv()` generan líneas CSV correctamente escapadas y delimitadas. 
Adicionalmente, `str_getcsv()` permite parsear cadenas directamente sin usar archivos. Hay que evitar usar `file()` para CSV.
En escenarios avanzados, se configuran controladores con `SplFileObject::setCsvControl()` y se adapta el comportamiento de escape, especialmente tras la deprecación del valor por defecto de escape en PHP 8.4 ([[1.1 What is PHP]]).

---
### Definición
```php
fgetcsv(
	resource $handle, 
	int $length = 0, 
	string $delimiter = ",", 
	string $enclosure = '"', 
	string $escape = '\/',
): array|false
```
Lee una línea de un recurso de archivo abierto y la parsea según el formato CSV, devolviendo un array de campos.

```php
fputcsv(
	resource $handle, 
	array $fields, 
	string $delimiter = ",", 
	string $enclosure = '"', 
	string $escape = '\/'
): int|false
```
Convierte un array en una línea CSV y lo escribe en el recurso de archivo.

```php
str_getcsv(
	string $input, 
	string $delimiter = ",", 
	string $enclosure = '"', 
	string $escape = '\/'
): array
```
Parsea a `CSV-formatted string` y retorna un `array` de campos.

```php
SplFileObject::fgetcsv(
	string $delimiter = ",", 
	string $enclosure = '"', 
	string $escape = '\/'
): array|false
```
Método orientado a objetos para leer y parsear líneas CSV de un `SplFileObject`.

```php
SplFileObject::fputcsv(
	array $fields, 
	string $delimiter = ",", 
	string $enclosure = '"', 
	string $escape = `\`, 
	string $eol = "\n"
): int|false
```
Método orientado a objetos para escribir `arrays` como líneas CSV

---
### Conceptos Clave
- **Delimitador, Comillas y Escape**
	- Puedes cambiar el delimitador y el carácter de comillas para adaptarse a distintos formatos CSV.
	- El carácter de escape (`\` por defecto) ahora debe especificarse explícitamente en PHP 8.4, ya que el valor por defecto esta deprecado. 
- **Lectura Segura vs Lectura Genérica**
	- No uses `file()` para CSV: rompe en saltos de línea dentro de campos con comillas.
	- Usa siempre `fgetcsv()`/`SplFileObject::fgetcsv()` para respetar el estándar RFC4180.
- **Procesamiento en Memoria vs Stream**
	- Para archivos pequeños, `file_get_contents` + `str_getcsv()` en `explode("\n")` puede servir.
	- Para grandes volúmenes, procesar con `fopen()` + `fgetcsv()` línea a línea o usando `SplFileObject` para menor uso de memoria.
- **Control de Formato Avanzado**
	- Con `SplFileObject::setCsvControl($delim, $enc, $esc)`, ajusta globalmente el parsing en un objeto.
	- En casos de parsing erróneo de escapes, puede usarse el `workaround` de escape nulo (`"0"`) en `fgetcsv()`/`fputcsv()`.

---
### Ejemplos Prácticos
##### Leer todo un CSV en `array` multidimensional
```php
<?php

$csv = [];
if (($fh = fopen("data.csv", "r")) !== false) {
	while (($row = fgetcsv($fh, 0, ";", '"', '\\')) !== false) {
		$csv[] = $row;
	}
	fclose($fh);
}

print_r($csv);

```
Ideal para `logs` o exportaciones de bases de datos.
##### Escribir registros en CSV con encabezados
```php
<?php

$headers = ["id", "nombre", "email"];
$user = [
	[1, "Ana", "ana@example.com"],
	[2, "Luis", "luis@example.com"],
];

$fp = fopen("users.csv", "w");
fputcsv($fp, $headers);
foreach ($users as $user) {
	fputcsv($fp, $user);
}

fclose($fp);

```
Puedes usar esta plantilla para exportar datos desde cualquier array
##### Parsear CSV desde una cadena (API)
```php
<?php

$csvString = "a,b,c\n1,2,3\n4,5,6";
$lines = explode("\n", $csvString);
$parsed = array_map(fn($l) => str_getcsv($l), $lines);

print_r($parsed);

```
Útil al recibir CSV por POST sin guardar en disco.
##### Usar `SplFileObject` para `streaming` control
```php
<?php

$file = new SplFileObject("big.csv");
$file->setFlags(SplFileObject::READ_CSV);
$file->setCsvControl(",", '"', "\\");
foreach ($file as $row) {
	var_dump($row);
}

```
Maneja archivos grandes con bajo consumo de memoria.
##### Leer CSV desde `STDIN` en script `CLI`
```php
<?php

stream_set_blocking(STDIN, 0);
$data = fgetcsv(STDIN);

if (is_array($data)) {
	print_r($data);
} else {
	echo "Proporciona un archivo CSV vía STDIN";
}

```
Adecuado para `pipelines` en `shell`.

---
## ✍️ Notas
- Para scripts CLI usar `SplFileObject` por su simplicidad y `flags` de control.