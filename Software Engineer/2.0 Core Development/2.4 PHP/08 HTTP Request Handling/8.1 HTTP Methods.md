En PHP, el método HTTP de la solicitud actual se obtiene principalmente a través de la variable superglobal ([[8.2 Super Global Variables]]) `$_SERVER['REQUEST_METHOD']`, que devuelve cadenas como `GET`, `POST`, `PUT`, `DELETE`, `OPTIONS`, entre otros [PHP](https://www.php.net/manual/en/reserved.variables.server.php?utm_source=chatgpt.com)[w3resource](https://www.w3resource.com/php/super-variables/%24_SERVER.php?utm_source=chatgpt.com). Comprender estos métodos es esencial para manejar formularios clásicos, construir `APIs RESTful` y responder correctamente a preflight de `CORS` (`OPTIONS`), todo ello garantizando que las operaciones seguras (lectura) se diferencien de las que modifican el estado (escritura). PHP también permite leer directamente el cuerpo de la petición para métodos como `PUT`, `PATCH`, o `DELETE` usando el `php://input`, lo que facilita procesar `payloads` JSON o XML sin depender de `$_POST`. Además, es fundamental manejar errores y validar el método antes de procesar la lógica de negocio, y en niveles avanzados implementar "`method override`" para soportar métodos no nativos de formularios HTML (por ejemplo, usando cabeceras `X-HTTP-Method-Override`).

---
### Definición
- **Método HTTP**: Verbo que indica la intención de la petición (lectura, creación, actualización, borrado) según la especificación HTTP/1.1
- `$_SERVER['REQUEST_METHOD']`: Superglobal que contiene el texto del método enviado por el cliente al servidor.
- **Streams de entrada**: `php://input` permite leer el cuerpo bruto de la petición para métodos no `GET` o `POST` y sin `multipart/form-data`.

---
### Conceptos Clave
1. **Métodos seguros vs no seguros**
	- Métodos seguros (`GET`, `HEAD`, `OPTIONS`) no deben alterar es estado del servidor.
	- Métodos que modifican datos (`POST`, `PUT`, `PATCH`, `DELETE`) pueden alterar recursos en el servidor.
2. **Idempotencia**
	- Métodos idempotentes (`GET`, `PUT`, `DELETE`, `OPTIONS`) producen el mismo resultado al repetirse varias veces.
	- `POST` no es idempotente: cada petición puede generar un nuevo recurso.
3. **Lectura de parámetros**
	- `$_GET` y `$_POST` cubren `GET` y `POST`, respectivamente, mientras `$_REQUEST` agrupa ambos y cookies.
	- Para métodos REST como `PUT` o `DELETE`, leer `raw body` con `file_get_contents('php://input')` y luego parsear `JSON/XML`.
4. **`Preflight` y `CORS`**
	- El método `OPTIONS` es clave en `CORS` para comprobar qué métodos están permitidos en un recurso antes de la petición real.
5. **`Method Override` en formularios HTML**
	- HTML sólo soporta `GET` y `POST`; `frameworks` usan parámetros ocultos (`_method=PUT`) o cabeceras `X-HTTP-Method-Override` para simular `PUT`, `DELETE`.

---
### Ejemplos Prácticos
##### Control de flujo según método
```php
<?php

switch ($_SERVER['REQUEST_METHOD']) {
    case 'GET':
        // Mostrar formulario o lista de recursos
        break;
    case 'POST':
        // Crear nuevo recurso
        break;
    case 'PUT':
        // Actualizar recurso
        parse_str(file_get_contents('php://input'), $data);
        break;
    case 'DELETE':
        // Eliminar recurso
        break;
    default:
        http_response_code(405);
        header('Allow: GET, POST, PUT, DELETE, OPTIONS');
        exit;
}

```
##### Leer JSON en POST
```php
<?php

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
	$payload = json_decode(file_get_contents('php://input'), true);
	// procesar payload
}

```
##### Manejo de CORS `preflight`
```php
<?php

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
	header('ccess-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS');
	header('Access-Control-Allow-Headers: Content-Type, X-HTTP-Method-Override');
    exit;
}

```
##### Formulario HTML con `method override`
```html
<form action="/user/1" method="POST">
  <input type="hidden" name="_method" value="DELETE">
  <button type="submit">Eliminar Usuario</button>
</form>
```

```php
$method = $POST['method'] ?? $_SERVER['REQUEST_METHOD'];
```
##### Validar método antes de procesar
```php
<?php

if (!in_array($_SERVER['REQUEST_METHOD'], ['GET', 'POST'])) {
	http_response_code(405);
	echo json_encode(['error' => 'Método no permitido']);
	exit;
}

```

---
## ✍️ Notas
- Siempre validar `$_SERVER['METHOD_REQUEST']` antes de procesar para evitar accesos no esperados.
- Usar `php://input` para consumir `JSON/XML` directamente y no confiar en `$_POST` para formatos distintos a formularios.
- Implementar `OPTIONS` y cabeceras `CORS` en un punto central de la aplicación para simplificar `middleware`.
