PHP gestiona el estado entre peticiones HTTP a través de cookies ([[1.07 Cookies]]), pequeños archivos que el servidor envía al cliente y que éste devuelve en cada solicitud ([MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie?utm_source=chatgpt.com)). La función principal es `setcookie()`, que permite definir nombre, valor, caducidad, ruta, dominio, seguridad, accesibilidad en JavaScript y política `SameSite` ([PHP](https://www.php.net/manual/en/function.setcookie.php?utm_source=chatgpt.com)[W3Schools](https://www.w3schools.com/php/func_network_setcookie.asp?utm_source=chatgpt.com)). Las cookies se configuran antes de enviar cualquier salida al navegador y se almacenan en `$_COOKIE` para su posterior lectura ([W3Schools](https://www.w3schools.com/php/php_cookies.asp?utm_source=chatgpt.com)[DEV Community](https://dev.to/harshm03/beginners-guide-to-php-form-handling-with-cookies-1el4?utm_source=chatgpt.com)). Para un manejo seguro, siempre se debe validar el código de error (`UPLOAD_ERR_*`), usar `is_uploaded_file()` y `move_uploaded_file()` no aplica aquí, en su lugar, verificar opciones como `secure`, `httponly` y `samesite` para proteger contra XSS y CSRF ([PHP](https://www.php.net/manual/en/function.session-set-cookie-params.php?utm_source=chatgpt.com)[Stack Overflow](https://stackoverflow.com/questions/39750906/php-setcookie-samesite-strict?utm_source=chatgpt.com)).

---
### Definición
- `Cookie`: Par clave-valor que el servidor instruye al navegador para almacenar y devolver en solicitudes posteriores, utilizando para identificar usuarios, guardar preferencias o gestionar sesiones.
- `setcookie(string $name, string $value = "", int|array $options = [])`: Define una cookie que se enviará en la cabecera HTTP `Set-Cookie` ([[1.06 HTTP Headers]]). En PHP 7.3+ puede aceptarse un array de opciones con claves `expires`, `path`, `domain`, `secure`, `httponly` y `samesite`.
- `SameSite`: Atributo de seguridad que controle si la cookie se envía con peticiones `cross-site` Valores posibles: `Lax`, `Strict` o `None`.

---
### Conceptos Clave
1. Parámetros de `seetcookie()`
	- `name` y `value`: Identificador y contenido de la cookie.
	- `expires`: UNIX `timestamp` o tiempo de vida en segundos.
	- `path`: Rutas donde la cookie es válida (p. ej. `/app`).
	- `domain`: Dominio que recibirá la cookie (`example.com`)
	- `secure`: Solo envía cookie sobre HTTPS.
	- `httponly`: Impide acceso desde JavaScript (`document.cookie`), mitigando XSS.
	- `samesite`: Controla envío en `cross-site`, reduciendo CSRF (`Lax` por defecto, `Strict` o `None`).
	***Analogía**: Imagina que la cookie es una tarjeta de socio (clave-valor) que entregas al browser; los parámetros (`path`, `domain`, `expires`) son reglas sobre dónde y cuándo esa tarjeta es aceptada.*
2. Timing y Cabeceras: 
	- Debes llamar a `setcookie()` antes de enviar cualquier HTML o `echo`, pues modifica la cabecera HTTP.
	- La respuesta HTTP puede incluir múltiples cabeceras `Set-Cookie` sin limitación.
3. Almacenamiento y Lectura
	- PHP almacena las cookies recibidas en `$_COOKIE` como un array asociativo ([[3.3 Associative Arrays]])`$_COOKIE['name'] => valor`.
	- Para actualizar el valor, llama de nuevo a `setcookie()` con el mismo nombre y nuevo valor.
4. Seguridad y Mejores Prácticas
	- `httponly` y `secure`: Uso obligatorio en cookies de sesión y autenticación.
	- Validar el valor antes de usarlo (sin confiar en su contenido).
	- `SameSite=None; Secure` juntos: navegador modernos exigen `Secure` si `SameSite=None`.

---
### Ejemplos Prácticos
##### Cookie simple con duración de un día
```php
<?php

setcookie('user', 'John Doe', [
  'expires'  => time() + 86400,
  'path'     => '/',
  'secure'   => true,
  'httponly' => true,
  'samesite' => 'Lax',
]);
```
##### Actualizar valor de cookie y lectura
```php
<?php

// Actualizar
setcookie('user', 'Alex Porter', time() + 3000, '/');

// Leer
if (isset($_COOKIE['user'])) {
	echo "Bienvenido, " . $_COOKIE['user'];
}
```
##### Cookie en subdominio y ruta específica
```php
<?php

setcookie('cart', $cartJson, [
  'expires'  => time() + 3600,
  'path'     => '/shop/',
  'domain'   => 'store.example.com',
  'secure'   => true,
  'httponly' => false,
  'samesite' => 'Strict',
]);
```
##### Cookies con array de valores
```php
<?php

$prefs = ['theme'=>'dark','lang'=>'es'];
setcookie('prefs[theme]', 'dark', time()+3600, '/');
setcookie('prefs[lang]', 'es', time()+3600, '/');
// Luego en $_COOKIE['prefs']['theme'] y ['lang']
```

---
## ✍️ Notas

- Tratar las cookies como llaves temporales que abren acceso a sesiones o preferencias, colocando candados (`secure`, `httponly`) y vallas (`sametime`) para protegerlas.
- Probar cómo el navegador recibe las cabeceras `Set-Cookie` con las `DevTools` para asegurar que las configuraciones se aplican correctamente.