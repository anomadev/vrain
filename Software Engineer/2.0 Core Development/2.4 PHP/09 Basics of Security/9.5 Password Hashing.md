PHP incorpora una API robusta para hashear contraseñas de forma segura mediante la función `password_hash()`, complementada con `password_verify()` para validación y `password_needs_rehash()` para mantener la fortaleza de los `hashes` con el tiempo. Utiliza algoritmos adaptativos como `bcrypt` (`PASSWORD_BCRYPT`) y Argon2 (`PASSWORD_ARGON2I`), que aplican rondas de cómputo o consumo de memoria para frenar ataques de fuerza bruta.

---
### Definiciones Principales
- `password_hash(string $password, string|int|null $algo, array $options = []): string`: Crea un hash de una contraseña usando un algoritmo fuerte y una `salt` generada automáticamente. El retorno incluye algoritmo, coste, `salt` y `hash`.
- `password_verify(string $password, string $hash): bool`: Comprueba que una contraseña en texto plano coincide con un `hash` almacenado, protegiendo contra ataques de tiempo.
- `password_needs_rehash(string $hash, string|int|null $algo, array $options = []): bool`: Determina si un `hash` existente debe regenerarse para ajustarse a un nuevo algoritmo o coste, facilitando actualizaciones de seguridad.
- Constantes de algoritmo
	- `PASSWORD_DEFAULT`: Evolutivo, actualmente `bcrypt`; cambia a futuros algoritmos más fuertes.
	- `PASSWORD_BCRYPT`: `bcrypt` con identificador `$2y$`; genera `hashes` de 60 caracteres.
	- `PASSWORD_ARGON2I`, `PASSWORD_ARGON2D`: Algoritmos Argon2 de memoria-intensivos; disponibles si PHP fue compilado con soporte Argon2.

---
### Conceptos Clave
1. **`Salt` y Auto-contenido**: Al usar `password_hash()`, `salt` se genera aleatoriamente y se incluye dentro del propio `hash`, eliminando la necesidad de almacenarla por separado.
2. **Algoritmos adaptativos**
	- `bcrypt`: ajusta el coste mediante el parámetro `cost` (default 12), incrementando exponentemente el tiempo tiempo de `hash`.
	- `Argon2`: permite configurar `memory_cost`, `time_cost` y `threads`, haciendo el `hashing` intensivo en memoria y CPU para resistir hardware moderno.
3. **Evolución de Seguridad**: La constante `PASSWORD_DEFAULT` está diseñada para mejorar su algoritmo con el tiempo; `password_needs_rehash()` detecta cuándo debes regenerar `hashes` viejos con nuevos parámetros.
4. **Almacenamiento en Base de Datos**: Debido a que `bcrypt` puede generar `hashes` más largos en el futuro, reserva una columna `VARCHAR(255)` para evitar truncamientos.
5. **Prevención de Errores Comunes**: 
	- Evitar manejar el `salt` manualmente; el parámetro `salt` está deprecado y se ignora desde PHP 8 ([[1.1 What is PHP]]).
	- Siempre usa `password_verify()` en lugar de comparar `hashes` directamente para protegerte contra `timing attacks`.

---
### Ejemplos Prácticos
##### Crear un hash al registrar un usuario
```php
<?php

$password = $POST['password'];
$hash = password_hash($password, PASSWORD_DEFAULT);
// Guardar $hash en la base de datos.
```
Genera un hash con `bcrypt` (o algoritmo futuro) y `salt` automática.
##### Verificar la contraseña en `login`
```php
<?php

$hash = /* obtener de db */

if (password_verify($_POST['password'], $hash)) {
	// Contraseña válida
} else {
	// Contraseña incorrecta
}
```
Aísla los datos de usuario del algoritmo y la `salt`.
##### `Rehash` automático con nueva configuración de coste
```php
<?php

$hash = /* obtener de BD */;
$options = ['cost' => 14];

if (password_needs_rehash($hash, PASSWORD_BCRYPT, $options)) {
    $newHash = password_hash($_POST['password'], PASSWORD_BCRYPT, $options);
    // Actualizar BD con $newHash
}
```
Mantiene `hashes` al día con políticas de seguridad.
##### Usar `Argon2d` para máxima resistencia
```php
<?php

$options = ['memory_cost'=>1<<17, 'time_cost'=>4, 'threads'=>2];
$hash = password_hash($password, PASSWORD_ARGON2ID, $options);
```
Ajusta memoria y CPU según infraestructura
##### Obtener información de un `hash`
```php
<?php

$info = password_get_info($hash);
// $info['algo'], $info['options']
```
Útil para registros o debugging de configuraciones.

---
## ✍️ Notas

- Siempre usar `PASSWORD_DEFAULT` para aprovechar futuras mejoras sin cambios de código.