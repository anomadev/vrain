PHP ofrece **mecanismos de autenticación HTTP** (`Basic` y `Digest`) integrados que, mediante el envío de cabeceras ([[1.06 HTTP Headers]]) `WWW-Authenticate` y la lectura de variables como `$_SERVER['PHP_AUTH_USER']` y `$_SERVER['PHP_AUTH_PW']`, permiten proteger páginas sin depender de sesiones ([[8.6 Sessions]]) ni cookies ([[1.07 Cookies]]) ([PHP](https://www.php.net/manual/en/features.http-auth.php?utm_source=chatgpt.com)). Estas funciones solo están disponibles cuando PHP corre como módulo de Apache ([[22.1 Apache]]) (no en `CGI/FastCGI` por defecto) a menos que el servidor reenvíe explícitamente la cabecera `Authorization` ([ifj.edu.pl](https://www.ifj.edu.pl/~krawczyk/php/features.http-auth.html?utm_source=chatgpt.com)). El flujo típico involucra: 1) detectar ausencia de credenciales, 2) emitir `401 Unauthorized` y `WWW-Authenticate`, 3) capturar usuario y contraseña proporcionados, 4) validarlos contra tu fuente (base de datos, archivo), y 5) otorgar o denegar acceso ([php.p2hp.com](https://php.p2hp.com/manual/en/features.http-auth.php?utm_source=chatgpt.com)). Aunque Basic envía las credenciales en Base64 (no cifradas), `Digest` mejora la seguridad al usar **`hashes`** y **`nonces`**, aunque requiere soporte del servidor y cliente.

---
### Definición
**HTTP Basic Authentication** en PHP consiste en solicitar al navegador un **diálogo de usuario/contraseña** mediante las cabeceras:
```http
WWW-Authenticate: Basic realm="Mi Área Segura"
HTTP/1.0 401 Unauthorized
```
y luego leer las credenciales en `$_SERVER['PHP_AUTH_USER']` y `$_SERVER['PHP_AUTH_PW']`.
**`HTTP Digest Authentication`** añade un **hash** de la contraseña y un **`nonce`** para prevenir la transmisión en texto claro, usando cabeceras `WWW-Authenticate: Digest …` y leyendo variables como `PHP_AUTH_DIGEST`.

---
### Conceptos Clave
1. Disponibilidad: Solo funciona con PHP como **módulo de servidor** (`mod_php`) en Apache; con `CGI/FastCGI` es necesario reenviar `Authorization` manualmente (p.ej., `SetEnvIf Authorization .+ HTTP_AUTHORIZATION=$0`).
2. Flujo de `Basic Auth`
	- **Petición inicial**: navegador solicita recurso.
	- **Desafío**: servidor envía `401 Unauthorized` + `WWW-Authenticate` ([php.p2hp.com](https://php.p2hp.com/manual/en/features.http-auth.php?utm_source=chatgpt.com)).
    - **Respuesta del cliente**: el navegador reenvía la petición con cabecera `Authorization: Basic <credenciales>` ([DevDungeon](https://www.devdungeon.com/content/http-basic-authentication-php?utm_source=chatgpt.com)).
    - **Validación**: PHP expone `$_SERVER['PHP_AUTH_USER']` y `$_SERVER['PHP_AUTH_PW']` para autenticar al usuario.
3. Seguridad y Limitaciones
	- **`Basic`** transmite credenciales en Base64 (solo ocultamiento, no cifrado) y requiere HTTPS para seguridad.
	- **`Digest`** usa MD5, `nonce` y `opaque` para que la contraseña nunca viaje en claro, pero su soporte puede variar en clientes y servidores.
4. Variables de Entorno
	-  `$_SERVER['PHP_AUTH_USER']`, `$_SERVER['PHP_AUTH_PW']` para `Basic`.
	-  `$_SERVER['PHP_AUTH_DIGEST']` para `Digest` (contiene todo el encabezado).
5. `Realm`: El parámetro **`realm`** define el ámbito de la autenticación y se muestra al usuario en el diálogo de `login`; úsalo para informar qué recurso están protegiendo.

---
### Ejemplos Prácticos
##### Autenticación Básica en PHP
```php
<?php

if (!isset($_SERVER['PHP_AUTH_USER'])) {
    header('WWW-Authenticate: Basic realm="Área Restringida"');
    header('HTTP/1.0 401 Unauthorized');
    echo 'Acceso denegado.';
    exit;
}
// Validación simple
if ($_SERVER['PHP_AUTH_USER'] === 'admin' && $_SERVER['PHP_AUTH_PW'] === 'secret') {
    echo "Bienvenido, {$_SERVER['PHP_AUTH_USER']}";
} else {
    header('HTTP/1.0 403 Forbidden');
    echo 'Credenciales incorrectas.';
}
```
Pide usuario/clave y valida manualmente.
##### Soporte para `CGI/FastCGI` (Apache)
```htaccess
# En .htaccess o config Apache
SetEnvIf Authorization .+ HTTP_AUTHORIZATION=$0
```
Permite que PHP reciba `PHP_AUTH_*` variables bajo `CGI/FastCGI`.
##### Autenticación `Digest` (básico)
```php
<?php

$realm = 'Área Segura';
$users = ['admin'=>'secret'];

if (!isset($_SERVER['PHP_AUTH_DIGEST'])) {
    header('HTTP/1.1 401 Unauthorized');
    header('WWW-Authenticate: Digest realm="'.$realm.
           '",qop="auth",nonce="'.uniqid().'",opaque="'.md5($realm).'"');
    exit;
}

if (!($data = http_digest_parse($_SERVER['PHP_AUTH_DIGEST'])) ||
    !isset($users[$data['username']])) {
    die('Credenciales no válidas');
}

$A1 = md5($data['username'].':'.$realm.':'.$users[$data['username']]);
$A2 = md5($_SERVER['REQUEST_METHOD'].':'.$data['uri']);
$valid_response = md5($A1.':'.$data['nonce'].':'.$data['nc'].':'.$data['cnonce'].':'.$data['qop'].':'.$A2);

if ($data['response'] !== $valid_response) {
    die('Respuesta inválida');
}

echo "Usuario digest autenticado: {$data['username']}";
// Función helper http_digest_parse() parsea el header Digest.
```
Implementa `Digest` con cálculo de `hash MD5` y validación de `nonce`.
##### `APIs` con `Basic stateless`
```php
<?php

// Solo para APIs sobre HTTPS
if (!isset($_SERVER['PHP_AUTH_USER'])) {
    header('HTTP/1.1 401 Unauthorized');
    exit(json_encode(['error'=>'Se requiere autenticación']));
}

if (!authenticate_api($_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'])) {
    header('HTTP/1.1 403 Forbidden');
    exit(json_encode(['error'=>'Credenciales inválidas']));
}
// Seguir con la respuesta JSON...
```
Buen candidato para autenticación de microservicios.
