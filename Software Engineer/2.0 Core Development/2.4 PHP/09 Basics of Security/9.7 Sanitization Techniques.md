La función **`filter_var()`** de PHP es la piedra angular para **sanitizar** y **validar** entradas de usuario de forma segura y concisa. Con ella puedes aplicar filtros de **saneamiento** (`FILTER_SANITIZE_*`), que limpian datos eliminando caracteres peligrosos, o de **validación** (`FILTER_VALIDATE_*`) ([[9.1 Input Validation]]), que comprueban que los datos cumplan formatos específicos sin alterar el valor original ([PHP](https://www.php.net/manual/en/function.filter-var.php?utm_source=chatgpt.com)). Al combinar **opciones** (por ejemplo, rangos en enteros) y **`flags`** (como `FILTER_FLAG_STRIP_LOW` para eliminar caracteres de control), adaptas el filtrado a cada contexto. Ejemplos cotidianos incluyen limpiar HTML de comentarios, normalizar `URLs`, sanear direcciones de correo o desinfectar cadenas antes de almacenarlas en bases de datos ([W3Schools](https://www.w3schools.com/php/php_filter.asp?utm_source=chatgpt.com)). Además, filtros de **`callback`** permiten personalizar el saneamiento con funciones propias ([Stack Overflow](https://stackoverflow.com/questions/8426503/using-filter-var-to-sanitize-a-string?utm_source=chatgpt.com)).

---
### Definición de `filter_var()`
```php
mixed filter_var(
  mixed  $value,
  int    $filter  = FILTER_DEFAULT,
  array|int $options = 0
);
```
- **`$value`**: Dato a filtrar (será convertido a `string` internamente) 
- **`$filter`**: Constante que indica el tipo de filtro:
    - **Validación**: `FILTER_VALIDATE_EMAIL`, `FILTER_VALIDATE_INT`, etc.
    - **Saneamiento**: `FILTER_SANITIZE_STRING`, `FILTER_SANITIZE_URL`, etc.
    - **RAW / `Callback`**: `FILTER_UNSAFE_RAW`, `FILTER_CALLBACK` 
- **`$options`**: Array de opciones específicas del filtro o combinación de **`flags`** (`FILTER_FLAG_*`) para ajustar el comportamiento
**Valores de retorno**:
- El **dato filtrado** (`string`, entero, etc.)
- **`false`** en validación fallida (o `null` si usas `FILTER_NULL_ON_FAILURE`)

---
### Conceptos Clave
##### Sanitización vs Validación
- **Sanitización**: Limpia el dato para eliminar o codificar caracteres no permitidos (p.ej. etiquetas HTML).
- **Validación**: Comprueba si el dato cumple un formato (correo, IP, entero) y devuelve `false` si falla.
##### Uso de `flags` y opciones
- **Flags** como `FILTER_FLAG_STRIP_LOW` eliminan caracteres de control de 0–31
- **Rangos** en validación de enteros:
```php
$age = filter_var(
	$_POST['age'],
	FILTER_VALIDATE_INT,
	['options' => ['min_range' => 18, 'max_range' => 99]]
);
```
##### `callbacks` para lógica personalizada
Con `FILTER_CALLBACK` invocas una función propia:
```php
$clean = filter_var($raw, FILTER_CALLBACK, ['options' => 'my_cleaner']);
```
##### Filtrado de `arrays`
Para múltiples valores en `$_GET` o `$_POST`, emplea `filter_var_array()` o `FILTER_REQUIRE_ARRAY`

---
### Ejemplos Prácticos
##### Eliminar etiquetas HTML de un comentario
```php
<?php

$comment = "<script>alert('XSS')</script>Hola";
$safe    = filter_var($comment, FILTER_SANITIZE_STRING);
echo $safe; // "alert('XSS')Hola"
```
##### Sanitizar y Validar un correo
```php
$emailRaw   = "joe(at)example.com";
$emailClean = filter_var($emailRaw, FILTER_SANITIZE_EMAIL);

if (filter_var($emailClean, FILTER_VALIDATE_EMAIL)) {
    // Correo válido
}
```
##### Limpiar URL
```php
$urlRaw = " https://ex%20ample.com ";
$url = filter_var($urlRaw, FILTER_SANITIZE_URL);

if (filter_var($url, FILTER_VALIDATE_URL)) {
   echo "URL válida: $url";
}
```
##### Validación de entero con rango
```php
$qty = filter_var(
	$_GET['qty'], 
	FILTER_VALIDATE_INT, 
	['options' => ['min_range' => 1, 'max_range' = >100]
]);

if ($qty === false) { /* error */ }
```
##### Callback para caracteres permitidos
```php
function onlyLetters($v) {
  return preg_replace('/[^A-Za-z]/','',$v);
}

$name = filter_var($_POST['name'], FILTER_CALLBACK, ['options'=>'onlyLetters']);
```

---
## ✍️ Notas

- Combinar `filter_var()` con **escape en salida** (`htmlspecialchars()` [[9.3 XSS Prevention]]) para defensa en profundidad.  
- Usar  **`callbacks`** ([[6.5 Anonymous Functions]]) cuando necesito reglas específicas no cubiertas por los filtros nativos.
