> [!info] Pest (Roadmap SH)
> `Pest` es un framework de pruebas innovador y elegante para PHP. Considérelo una alternativa elegante y optimizada a `PHPUnit`. `Pest` facilita la prueba de código PHP al habilitar casos de prueba expresivos y flexibles. Proporciona abstracciones de alto nivel para minimizar el código repetitivo sin afectar la integración de pruebas `PHPUnit` tradicionales.

`Pest` es un framework de pruebas para PHP, construido sobre `PHPUnit` ([[14.1 PHPUnit]]), que ofrece una sintaxis limpia, minimalista y altamente legible. Se centra en devolver la alegría de `testear`, con características como mensajes de error estilizados, ejecución en paralelo,  `snapshots`, y una API inspirada en `RSpect/Jest`. `Pest` permite mezclar `test` estilo BDD (`it()`, `test()`) con los clásicos de `PHPUnit`, y facilita la migración de suites existentes.

### Contenido Clave
##### Requisitos e instalación
- PHP ≥ 8.2
- Instalar con `Composer` ([[13.1 Composer]]) como dependencias de desarrollo:
```bash
composer require pestphp/pest --dev --with-all-dependencies
composer require pestphp/plugin-<framework> --dev # opcional, e.g. laravel
```
- Inicializar (genera `Pest.php` y estructura de `test`):
```bash
vendor/bin/pest --init
```
##### Estructura de directorios
```bash
├── src/                    # Código de producción
├── tests/
│   ├── Feature/            # Tests de funcionalidad/end-to-end
│   └── Unit/               # Tests unitarios
├── Pest.php                # Configuración de Pest
├── phpunit.xml             # Configuración PHPUnit heredada
└── vendor/
```
##### Sintaxis de `tests`
Test Unitario con `test()` o `it()`
```php
<?php

test('sum returns correct value', function () {
	expect(sum(1,2))->toBe(3);
});

it('throws on division by zero', function () {
	expect(fn() => divide(5,0))->toThrow(DivisionByZeroError::class);
});
```
`Expectations` en lugar de `assertions`
```php
<?php

expect->($value)
	->toBe($expected)
	->toBeInstanceOf(MyClass::class)
	->toHaveCount(3);
```
##### Migración desde `PHPUnit`
- No es obligatorio reescribir tests.
- Con `pest-plugin-drift` puedes convertir tests `PHPUnit` ([[14.1 PHPUnit]]) a `Pest` automáticamente.
##### Características destacadas
- Paralelismos nativo: `--parallel` ejecuta suites en múltiples procesos.
- `Snapshot Testing` para comparar salidas complejas
- `Interactive Mode`: `--watch` vuelve a correr tests al guardar cambios
- `Plugins`: ecosistema activo (Laravel, Drip, etc.)
- Cobertura: `--coverage` hereda opciones de `PHPUnit`

### Analogías
- **Pest es como un café de especialidad**: ofrece la misma energía (tests) que `PHPUnit`, pero con una experiencia más refinada, sabores (API) más suaves y un ambiente (mensajes de error) más agradable.
- **`Test-Driven Development` (TDD)** con Pest se siente como escribir un diálogo en ves de un monólogo: cada `it('...')` explica en lenguaje natural qué se espera.

### Ejemplos Prácticos
##### Primer test en un nuevo proyecto
```bash
composer require pestphp/pest --dev --with-all-dependencies
vendor/bin/pest --init
```

```php
<?php
// tests/Unit/SumTest.php

test('sum function adds two numbers', function () {
	function sum(int $a, int $b): int { return $a + $b; }
	expect(sum(2, 3))->toBe(5);
});
```

```bash
vendor/bin/pest
```
##### Test de servicio con inyección de dependencias
```php
<?php
// src/Notifier.php
class Notifier {
	public function send(string $msg): bool { /* ... */  return true; }
}

// tests/Unit/NotifierTest.php
use App\Notifier;

it('sends notifications successfully', function () {
	$notifier = new Notifier();
	expect($notifier->send('Hello'))->toBeTrue();
});
```

```bash
vendor/bin/pest --parallel --coverage
```
Ejecuta tests en paralelo y produce reporte de cobertura compatible con `PHPUnit`.

### Notas
- Siempre definir `tests` en carpetas `Unit` y `Feature` para separar lógicas puras de pruebas `end-to-end` o integradas.
