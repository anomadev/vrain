> [!info] Style Tools (Roadmap SH)
> Las herramientas de estilo en PHP se refieren principalmente a herramientas estándar de codificación que ayudan a mantener un estilo de codificación consistente en todo el proyecto PHP. `PHP_CodeSniffer` es una herramienta popular en esta categoría. Tokeniza archivos PHP, JavaScript y CSS y detecta infracciones de un conjunto definido de estándares de codificación.

> [!info] PHPCodeSniffer (Roadmap SH)
> `PHPCodeSniffer`, a menudo abreviado como PHPCS, es una herramienta fantástica diseñada para que los desarrolladores de PHP mantengan estilos de codificaciones prolijos y consistentes en todos sus proyectos. Lo hace analizando los archivos PHP, JavaScript y CSS de su proyecto para detectar desviaciones de un conjunto definido de estándares de codificación. Cuando `PHPCodeSniffer` encuentra una violación, la marca para corregirla, haciendo así que su base de código sea más legible y armoniosa.

`PHPCodeSniffer` (PHPCS) es una herramienta que se encarga de analizar tu código PHP (y también JS/CSS) para detectar violaciones a estándares de estilo (PSR-1, PSR-12, Zend, PEAR, etc.) ([[18.1 PHP Framework Interoperability Group]]) y opcionalmente, corregir automáticamente muchos de esos errores con `phpcbf`. Gracias a PHPCS podrás mantener un estilo de código consistente, facilitar la lectura y el mantenimiento y automatizar la validación de tu estilo en local y en CI.

### Conceptos Clave
##### Instalación
```bash
composer require --dev squizlabs/php_codesniffer
```
o descargar `PHAR` desde https://squizlabs.github.io/PHP_CodeSniffer/phpcs.phar
##### Comandos básicos
- `phpcs --standard=PSR12 src/`: detecta violaciones
- `phpcbf --standard=PSR12 src/`: intenta auto-corregir errores detectados 
- Estándares Soportados: PSR-1, PSR-12 (recomendado), PEAR, Zend, Squiz, MySource, Drupal, WordPress, y `custom sulesets`.
- `Custom Ruleset`: archivos `phpcs.xml` o `ruleset.xml` permiten
	- Incluir/Excluir directorios o archivos
	- Ajustar severidad o nivel de errores 
	- Combinar reglas de varios estándares
- Integración CI/IDE:
	- GitHub Actions, GitLab CI, Jenkins: ejecuta `phpcs` como parte del `pipeline`
	- IDEs (PHPStorm, VSCode): plugins para reportar errores en tiempo real

### Analogías 
- **Inspector de tránsito**: PHPCS recorre tu "carretera de código" verificando que respetes señales de tránsito (spacing, indentación, nombres). Si incumples, sanciona (error) o te sugiere cómo corregir (`phpcbf`).
- **Checklist de calidad**: Antes de lanzar un producto, repasa un listado de criterios (tipos, formatos, convenciones). PHPCS ejecuta esa lista automáticamente, asegurando que nadie omita nada.

### Ejemplos Prácticos
##### Instalar y ejecutar contra PSR-12
```bash
composer require --dev squizlabs/php_codesniffer
vendor/bin/phpcs --standard=PSR12 src/
```
PHPCS escanea todos los archivos PHP en `src/` y reporta líneas que no cumplen PSR-12.
##### Auto-corrección con `phpcbf`
```bash
vendor/bin/phpcbf --standard=PSR12 src/
```
Intenta aplicar fixes automáticos. Tras ejecutarlo, mucho errores de estilo estarán resueltos; los restantes indican casos manuales.
##### Custom Ruleset (`phpcs.xml`)
```xml
<?xml version="1.0"?>
<ruleset name="MyProject Coding Standard">
  <description>Mix PSR-12 with custom rules</description>

  <!-- Incluir PSR12 -->
  <rule ref="PSR12"/>

  <!-- Excluir carpeta legacy -->
  <exclude-pattern>src/Legacy/*</exclude-pattern>

  <!-- Ajustar severidad de un sniff específico -->
  <rule ref="Generic.WhiteSpace.DisallowTabIndent">
    <severity>5</severity>
  </rule>
</ruleset>
```

```bash
vendor/bin/phpcs --standard=phpcs.xml
```
##### Integración en CI (GitHub Actions)
```yaml
name: Code Sniffer

on: [push, pull_request]

jobs:
  sniffer:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with: { php-version: '8.1' }
      - name: Install dependencies
        run: composer install --no-interaction --prefer-dist
      - name: Run PHPCS
        run: vendor/bin/phpcs --standard=PSR12 src/

```

### Notas
- Siempre instalar `PHPCS` como dependencia de desarrollo y registrar `commit` el `phpcs.xml` para mantener reglas compartidas.
- PSR-12 como base, pero añadir `Slevomat Coding Standard` para reglas adicionales de calidad.
- Usar `phpcbf` regularmente antes de `commits` para corregir automáticamente la mayoría de problemas de estilo.
- En proyectos muy grandes, excluir carpetas de terceros o legacy y crear un comando de `Composer` ([[13.1 Composer]]) (`"cs-check": "phpcs"`) para facilitar su ejecución.
- Configurar el IDE (`VSCode` o `PHPStorm`) para que PHPCS muestre errores de estilo en tiempo real evitando sorpresas al correr CI.
