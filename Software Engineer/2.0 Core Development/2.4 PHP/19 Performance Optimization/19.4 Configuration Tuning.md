> [!info] Configuration Tuning (Roadmap SH)
> Para optimizar el rendimiento en PHP, ajustar la configuración es crucial. Puedes modificar varios ajustes en tu archivo `php.ini` para mejorar el rendimiento de tu aplicación PHP. Por ejemplo, `memory_limit` es un parámetro clave que especifica la cantidad máxima de memoria que un script puede consumir. Optimizar esta configuración evitará que los scripts PHP consuman todos los recursos del servidor. De igual forma, ajustar el tiempo máximo de ejecución `max_execution_time` limita el tiempo de ejecución de un script. Solo asegúrese de realizar una configuración cuidadosa, ya que una configuración restrictiva podría causar problemas.

### Definición
El ajuste de configuración (o `tuning`) en PHP se refiere al proceso de modificar las directivas del archivo `php.ini` ([[20.4 Configuration Files]]) para optimizar el comportamiento del motor de PHP según el entorno y la carga de trabajo específicos. El objetivo es encontrar un balance entre rendimiento, seguridad y consumo de recursos.
No existe una configuración "perfecta" para todos; la configuración ideal para un entorno de desarrollo es peligrosa e ineficiente para uno de producción.

**Analogía**: Configurar `php.ini` es como ajustar un coche de carreras.
- **En desarrollo**: Quieres que el coche sea fácil de manejar y que te dé toda la telemetría posible. Abres todos los diagnósticos (`display_errors = On`), usas neumáticos blandos para un agarre máximo (`límites de memoria altos`) y no te preocupas por el consumo de combustible.
- **En producción (la carrera)**: Quieres el máximo rendimiento y fiabilidad. Apagas todos los diagnósticos en la cabina para no distraer al piloto (`display_errors = Off`), usas neumáticos duros para durar toda la carrera (`límites de recursos razonables`) y ajustas el motor para que sea eficiente y no falle (`configuraciones de seguridad activadas`).

### Conceptos Clave
- **Entornos Separados**: La regla de oro es tener configuraciones diferentes para desarrollo y producción. La de desarrollo se enfoca en la depuración, mientras que la de producción se enfoca en la seguridad y el rendimiento.
- **Gestión de Recursos**: Son las directivas que controlan cuánta memoria y tiempo puede consumir un script. Son vitales para prevenir que un solo proceso malicioso o con errores tumbe todo el servidor.
	- `memory_limit`: La cantidad máxima de memoria que un script puede consumir.
	- `max_execution_time`: El tiempo máximo en segundos que un script puede ejecutarse.
	- `max_input_time`: El tiempo máximo que un script puede pasar procesando datos de entrada (`POST`, `GET`).
- **Manejo de Errores**: Define qué se hace cuando ocurre un error.
	- `display_errores`: `On` en desarrollo para ver los errores en pantalla; `Off` en producción para exponer información sensible.
	- `log_errors`: `On` en producción para que los errores se guarden en un archivo log sin mostrarlos al usuario.
	- `error_reporting`: Define qué nivel de errores se reportan. `E_ALL` es estándar en desarrollo.
- **Manejo de Archivos**: Controla el tamaño de los archivos que se pueden subir a través de un formulario.
	- `upload_max_filesize`: El tamaño máximo para un solo archivo.
	- `post_max_size`: El tamaño máximo de toda la petición `POST` (debe ser mayor o igual a `upload_max_filesize`).
- **Seguridad**: Directivas para reducir la superficie de ataque
	- `expose_php`: `Off` en producción para no revelar la versión de PHP en los `headers` HTTP.
	- `disable_functions`: Permite deshabilitar funciones de PHP potencialmente peligrosas si no se usan (ej. `exec`, `shell_exec`).

### Ejemplos Prácticos
##### Configuración típica para producción (`php.ini`)
Optimiza para seguridad y rendimiento.
```ini,toml
; php.ini - Production Settings

; --- Security ---
; Do not expose PHP version in HTTP headers
expose_php = Off
; Disable potentially dangerous functions if not needed
; disable_functions = exec,passthru,shell_exec,system

; --- Error Handling ---
; Do NOT display errors to the user
display_errors = Off
; Log errors to a file instead
log_errors = On
; You can specify the log file path, e.g., error_log = /var/log/php/error.log
; Report all errors except deprecations and notices
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT

; --- Resource Limits ---
; Set a reasonable memory limit (e.g., 128MB or 256MB)
memory_limit = 128M
; Maximum execution time of 30 seconds is standard for web requests
max_execution_time = 30
; Max file upload size (e.g., 8MB)
upload_max_filesize = 8M
post_max_size = 10M
```
##### Configuración típica para desarrollo (`php.ini`)
Optimizada para la depuración y facilidad de uso.
```ini,toml
; php.ini - Development Settings

; --- Security (less strict for local dev) ---
expose_php = On

; --- Error Handling ---
; Display all errors directly in the browser/terminal
display_errors = On
log_errors = On ; It's good to log them anyway
; Report every possible error to catch bugs early
error_reporting = E_ALL

; --- Resource Limits ---
; Set a higher memory limit for debugging tools like Xdebug
memory_limit = 512M
; A higher execution time for long debugging sessions
max_execution_time = 300
; Allow larger file uploads for testing purposes
upload_max_filesize = 100M
post_max_size = 120M
```
