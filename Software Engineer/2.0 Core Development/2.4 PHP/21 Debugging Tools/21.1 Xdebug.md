> [!info] Xdebug (Roadmap SH)
> `Xdebug` es una extensi贸n de PHP que ofrece funciones de depuraci贸n y generaci贸n de perfiles. Es una potente herramienta que te ayuda a comprender el funcionamiento de tu c贸digo, detectar errores y optimizar el rendimiento. Con `Xdebug`, puedes establecer puntos de interrupci贸n, observar variables y recorrer tu c贸digo l铆nea por l铆nea. `Xdebug` puede acelerar significativamente el seguimiento de errores y las pruebas, lo que lo convierte en una herramienta esencial en el kit de herramientas de cualquier desarrollador en PHP.

### Definici贸n
`Xdebug` es una extensi贸n de PHP que proporciona un abanico de funcionalidades para la depuraci贸n y el desarrollo. Aunque es multifac茅tica (ofrece `profiling` ([[19.1 Profiling Techniques]]), an谩lisis de cobertura de c贸digo, etc.), su funci贸n m谩s conocida y poderosa es el `step debugging` (depuraci贸n por pasos).
La depuraci贸n por pasos permite pausar la ejecuci贸n de un script en cualquier punto para inspeccionar su estado (el valor de todas las variables, la pila de llamadas) y luego continuar la ejecuci贸n l铆nea por l铆nea. Es un salto cualitativo enorme frente a depurar usando `echo`, `var_dump` o `dd()`.

**Analog铆a**: Depurar con `var_dump` es como intentar entender una pel铆cula viendo solo una series de fotos fijas que has pedido por adelantado. La depuraci贸n por pasos con `Xdebug` es como tener el control remoto de la pel铆cula. Puedes ponerle pausa en cualquier fotograma (`breakpoint`), usar la c谩mara lenta para avanzar escena por escena (`stepping`), y hacer zoom en cualquier detalle de la imagen para ver qu茅 est谩 pasando (`inspecci贸n de variables`). Te da un control y una visibilidad completo sobre la narrativa (el flujo de ejecuci贸n).

### Conceptos Clave
- **`Step Debugging` (Depuraci贸n Interactiva**): Es el n煤cleo de la funcionalidad. Se basa en:
	- **`breakpoints` (puntos de ruptura)**: Marcadores que el desarrollador pone en el c贸digo a trav茅s de su IDE. Cuando `Xdebug` encuentra un `breakpoint`, pausa la ejecuci贸n.
	- **`stepping` (Avance por pasos)**: Una vez pausado, el desarrollador puede avanzar:
		- **`step over` (F8)**: Ejecuta la l铆nea actual y pasa a la siguiente. Si la l铆nea es una llamada a funci贸n, la ejecuta por completo sin entrar en ella.
		- **`step into` (F7)**: Si la l铆nea actual es una llamada a funci贸n, entra dentro de esa funci贸n para depurarla l铆nea a l铆nea.
		- **`step out` (Shift + F8)**: Termina de ejecutar la funci贸n actual y vuelve al punto donde fue llamada.
	- **Inspecci贸n de Variables**: Mientras est谩 en pausa, el IDE muestra el valor de todas las  variables locales, globales y de objetos en ese preciso instante.
- **Integraci贸n con el IDE**: `Xdebug` no tiene una interfaz gr谩fica. Act煤a como un "servidor" que se comunica con un "cliente" de depuraci贸n. Este cliente casi siempre es tu IDE (`PHPStorm`, `VS Code`, etc.). La comunicaci贸n se realiza a trav茅s de un protocolo llamado `DBGP`.
- **Configuraci贸n en `php.ini`**: `Xdebug` se controla con directivas en `php.ini` ([[20.4 Configuration Files]]). Las esenciales para la depuraci贸n son:
	- `xdebug.mode = debug`: Activa el modo depuraci贸n por pasos.
	- `xdebug.client_host`: La IP donde el IDE est谩 "escuchando" (normalmente `127.0.0.1` o una IP de Docker).
	- `xdebug.client_port`: El puerto donde el IDE escucha (el por defecto es `9003`).
	- `xdebug.start_with_request`: `yes` para intentar depurar cada petici贸n, o `trigger` para activarlo solo bajo demanda (m谩s eficiente).
- **Otras funcionalidades**:
	- `Profiler`: Genera archivos `cachegrind` para an谩lisis de rendimiento.
	- `Code Coverage`: Analiza qu茅 l铆neas de c贸digo son ejecutadas durante los tests.
	- Mejora de `var_dump()`: Sobrescribe la funci贸n `var_dump()` por defecto para mostrar una salida con colores, formato y l铆mites de profundidad, mucho m谩s legible.

### Ejemplos Pr谩cticos
##### Configuraci贸n t铆pica para depuraci贸n (`php.ini`)
Esta configuraci贸n le dice a `Xdebug` que active el modo de depuraci贸n y que se conecte a un IDE que est谩 escuchando en el puerto 9003 de la m谩quina local.
```ini,toml
; php.ini - Xdebug Step Debugging Settings

zend_extension=xdebug

; Primary mode set to 'debug'
xdebug.mode=debug

; Tell Xdebug to connect back to your IDE
xdebug.client_host=127.0.0.1
xdebug.client_port=9003

; Automatically start a debugging session for every request.
; Use "trigger" for on-demand debugging in a busy dev environment.
xdebug.start_with_request=yes
```
##### El flujo de trabajo de depuraci贸n (conceptual)
- En el IDE: El desarrollador hace clic en el margen de una l铆nea de c贸digo para poner un `breakpoint` (un punto rojo).
```php
<?php
function calculateTotal(array $items) {
    $total = 0;
  foreach ($items as $item) { // Breakpoint set here
        $total += $item['price'];
    }
    return $total;
}
$orderItems = [['price' => 10], ['price' => 20], ['price' => 30]];
echo calculateTotal($orderItems);
```
- En el IDE: El desarrollador activa el modo "Escuchar conexiones de `Xdebug`" (un icono de tel茅fono o un bicho).
- En el Navegador: El desarrollador refresca la p谩gina que ejecuta este script.
- La Magia Ocurre: La ejecuci贸n del script se congela justo en la l铆nea del `foreach`.
- De vuelta en el IDE: La l铆nea del `foreach` aparece resaltada. Una ventana de "variables" muestra:
	- `$items`: `array(3) [...]`
	- `$total`: `0`
- Interacci贸n: El desarrollador presiona la tecla "`Step Over`" (`F8`). La ejecuci贸n avanza una l铆nea. La ventana de variables ahora muestra:
	- `$items`: `array(3) [...]`
	- `$item`: `array(1) ['price' => 10]`
	- `$total`: `10`
	El desarrollador puede seguir presionando `F8` para ver c贸mo `$total` se va acumulando en cada iteraci贸n, confirmando que la l贸gica es correcta.

