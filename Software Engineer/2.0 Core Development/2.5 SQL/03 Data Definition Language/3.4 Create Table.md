La sentencia `CREATE TABLE` en SQL pertenece al DDL y se utiliza para crear una nueva tabla dentro de una base de datos relacional. Una tabla está formada por columnas (campos) que definen el tipo de dato a almacenar y, una vez creada, sirve para guardar filas (registros) que cumplen con esa definición.

> Analogía: Imagina que vas a comenzar a organizar libros en una biblioteca. Necesitas definir primero el "estante" donde se guardarán los libros, qué información exhibirá (por ejemplo, Título, Autor, Año de publicación) y qué reglas se aplicarán (por ejemplos, cada libro debe tener un ISBN único). Ese "estante" equivale a la tabla, y los atributos como "Título" o "ISBN" son las columnas. Una vez definido, podrás colocar (insertar) libros (filas) en él.

---
### Conceptos Clave
##### Sintaxis básica
```sql
CREATE TABLE nombre_tabla (
  columna1 tipo_dato [CONSTRAINTS],
  columna2 tipo_dato [CONSTRAINTS],
  ...
  columnaN tipo_dato [CONSTRAINTS],
  [CONSTRAINT nombre_constraint] PRIMARY KEY (columnaPK)
);
```
- `nombre_tabla`: nombre único de la tabla en la base de datos.
- `columnaX tipo_dato`: cada columna se declara con un nombre y un tipo de dato (p.ej., `INT`, `VARCHAR(50)`, `DATE`).
- `CONSTRAINTS`: restricciones como `NOT NULL`, `UNIQUE`, `CHECK`, `FOREIGN KEY`, etc.
- `PRIMARY KEY`: define la(s) columna(s) que identifican de forma única cada fila.
##### Tipos de datos comunes
- Numéricos: `INT`, `SMALLINT`, `BIGINT`, `DECIMAL(p,s)`, `FLOAT`, `REAL`.
- Cadenas: `CHAR(n)`, `VARCHAR(n)`, `TEXT`.
- Fecha y hora: `DATE`, `TIME`, `DATETIME`/`TIMESTAMP`.
- Binarios: `BINARY(n)`, `VARBINARY(n)`, `BLOB`.
- Misceláneos: `BOOLEAN`, `UUID`, `JSON`/`JSONB` (según el motor).
##### Restricciones (`cosntraints`)
- `PRIMARY KEY`: identifica unívocamente cada fila. No admite valores `NULL` y debe ser único.
- `NOT NULL`: impide que la columna acepte valores nulos.
- `UNIQUE`: garantiza que todos los valores en esa columna (o combinación de columnas) sean distintos.
- `FOREIGN KEY`: referencia a la clave primaria de otra tabla para mantener integridad referencial.
- `CHECK`: define una condición que cada fila debe cumplir (p.ej., `CHECK (edad >= 18)`).
##### `CREATE IF NOT EXISTS`
La cláusula `IF NOT EXISTS` permite crear la tabla solo si **no existe** ya con ese nombre, evitando errores en caso de que ya esté creada.
```sql
CREATE TABLE IF NOT EXISTS nombre_tabla (
  ...
);
```
Muy útil en scripts de migración para no detener la ejecución si la tabla ya existe.
##### Crear tabla a partir de otra (CTAS)
Se puede crear una nueva tabla basada en la estructura y datos de una tabla existente:
```sql
CREATE TABLE tabla_nueva AS
SELECT columna1, columna2, ...
FROM tabla_existente
WHERE condición;
```
Esto copia la definición de las columnas seleccionadas y los datos que cumplan la `condicion`. No siempre hereda índices o restricciones.
##### Orden y convenciones
- Conviene definir primero la columna que será `PRIMARY KEY`
- Nombres: usar `snake_case` o `camelCase` de forma consistente. Por ejemplo: `clientes`, `ordenes_detalle`
- Tipos de datos y tamaños: pensar realísticamente en los valores esperados para optimizar espacio y rendimiento (p. ej. usar `SMALLINT` en lugar de `INT` si el rango de valores es pequeño).

---
### Ejemplos Prácticos
##### Tabla de clientes para una tienda
`Escenario`: Una tienda en línea quiere almacenar información de sus clientes, incluyendo datos de contacto y fecha de registro.
```sql
CREATE TABLE clientes (
  cliente_id   SERIAL PRIMARY KEY,        -- ID único y autoincremental
  nombre       VARCHAR(100) NOT NULL,     -- Nombre completo, no nulo
  correo       VARCHAR(150) NOT NULL UNIQUE, -- Correo único (no repite)
  telefono     VARCHAR(20),               -- Teléfono (opcional)
  fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Fecha y hora de registro
  activo       BOOLEAN DEFAULT TRUE       -- Si el cliente está activo
);
```
1. Define `cliente_id` como `SERIAL` (auto-incremental) y clave primaria.
2. `nombre` y `correo` son obligatorios (`NOT NULL`), y `correo` debe ser único (`UNIQUE`)
3. `telefono` es opcional
4. `fecha_registro` toma la fecha actual si no se especifica
5. `activo` es booleano y por defecto `TRUE`
##### Tabla de productos con categorías y precio
`Escenario`: El catálogo de producto de la tienda necesita almacenar nombre, descripción, categoría y precio.
```sql
CREATE TABLE categorias (
  categoria_id SERIAL PRIMARY KEY,
  nombre       VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE productos (
  producto_id   SERIAL PRIMARY KEY,
  nombre        VARCHAR(100) NOT NULL,
  descripcion   TEXT,
  categoria_id  INT NOT NULL,
  precio        DECIMAL(10,2) NOT NULL CHECK (precio >= 0),
  en_stock      INT DEFAULT 0 CHECK (en_stock >= 0),
  creado_en     DATE DEFAULT CURRENT_DATE,
  CONSTRAINT fk_categoria
    FOREIGN KEY (categoria_id)
    REFERENCES categorias (categoria_id)
    ON DELETE RESTRICT
);
```
1. `categorias` almacena las categorías de productos, con `nombre` único
2. `productos` liga cada producto a una categoría (`FOREIGN_KEY`)
3. `precio` y `en_stock` tienen restricciones `CHECK` para que nunca sean negativos
4. `creado_en` guarda la fecha de creación del producto
##### Crear tabla a partir de otra (CTAS)
`Escenario`: Quieres hacer una copia de seguridad rápida de los productos más populares (aquellos con `en_stock > 100`) en una nueva tabla `productos_destacados`.
```sql
CREATE TABLE productos_destacados AS
SELECT producto_id, nombre, categoria_id, precio, en_stock
FROM productos
WHERE en_stock > 100;
```
1. Crea `productos_destacados` con las mismas columnas que el `SELECT`
2. Copia todas las filas de `productos` cuya existencia en stock supere 100
3. No hereda restricciones ni índices de `productos` (solo datos y estructura básica de columnas)
##### Usar `IF NOT EXISTS`
`Escenario`: En tus scripts de despliegue automatizado, no quieres que falle si la tabla ya existe.
```sql
CREATE TABLE IF NOT EXISTS historial_ventas (
  venta_id    SERIAL PRIMARY KEY,
  cliente_id  INT NOT NULL,
  fecha_venta TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  total       DECIMAL(10,2) NOT NULL,
  descripcion TEXT
);
```
- Si `historial_ventas` ya existe, no arroja error y continúa
- Si no existe, la crea con la estructura indicada
