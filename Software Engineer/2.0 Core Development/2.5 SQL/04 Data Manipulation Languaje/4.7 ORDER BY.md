> [!info] ORDER BY (Roadmap SH)
> La cláusula `ORDER BY` en SQL se utiliza para ordenar el conjunto de resultados de una consulta por una o más columnas. De forma predeterminada, la clasificación es en orden ascendente, pero puede especificar el orden descendente utilizando la palabra clave `DESC`. La cláusula puede ordenar por valores numéricos, de fecha o de texto, y se pueden ordenar varias columnas enumerándolas en la cláusula `ORDER BY`, cada una con su propia dirección de clasificación. Esta cláusula es crucial para organizar los datos en una secuencia significativa, como ordenar por marca de tiempo para mostrar primero los registros más recientes, o alfabéticamente por nombre.

### Definición
La cláusula `ORDER BY` se utiliza en SQL para ordenar el conjunto de resultados de una consulta según una o varias columnas, ya sea en orden ascendente (`ASC`) o descendente (`DESC`). Sin `ORDER BY`, el motor de base de datos puede devolver filas en un orden arbitrario (o de acuerdo a índices internos), pero no garantizado.

> [!info] Analogía
> Si tienes una lista de canciones en tu reproductor sin un orden fijo, `ORDER BY` es como seleccionar "Ordenar por artista" o "Ordenar por fecha agregada" para ver las canciones de esa manera.

### Conceptos Clave
##### Sintaxis básica
```sql
SELECT columnas
FROM tabla
[WHERE condicion]
ORDER BY columna1 [ASC|DESC];
```
- `ORDER BY columna1`: indica la columna por la cual ordenar.
- `ASC` (ascendente) es el valor por defecto; `DESC` (descendente) invierte el orden.
##### Ordenar por múltiples columnas
```sql
SELECT columnas
FROM tabla
ORDER BY columna1 [ASC|DESC], columna2 [ASC|DESC];
```
- El motor primero ordena por `columna1`; si hay empates; ordena esos empates según `columna2`.
##### Ordenamiento de valores `NULL`
- En muchos motores, los valores `NULL` se consideran menores que cualquier valor no nulo en orden ascendente; pueden aparecer al principio.
- Para cambiar esto, algunos DBMS permiten `NULLS FIRST` o `NULLS LAST`:
```sql
ORDER BY columa1 ASC NULLS LAST;
```
- No todos los motores soportan explícitamente esta sintaxis, pero PostgreSQL sí.
##### Ordenar por expresión o posición
```sql
SELECT nombre, LENGTH(nombre) AS largo
FROM clientes
ORDER BY LENGTH(nombre) DESC;
```
- Posición de columna en el `SELECT` (menos recomendable porque puede romper si cambias la lista)
```sql
SELECT nombre, edad
FROM empleados
ORDER BY 2 DESC; -- ordena por la segunda columna (edad)
```
##### Impacto en rendimiento
- `ORDER BY` obliga al motor a generar un orden definitivo, frecuentemente usando `sorting` en memoria y/o disco.
- En conjuntos de datos grandes, es beneficioso tener índices en las columnas para ordenar, de modo que el motor recupere filas ya ordenadas.
- Para paginación, combinar `ORDER BY` con `LIMIT` (o `OFFSET`) es común, pero puede ser costoso si el `offset` es muy grande.

### Ejemplos Prácticos
##### Listar productos por precio ascendente
```sql
-- En una tienda en línea, quieres mostrar los productos más baratos primero

SELECT producto_id, nombre_producto, precio
FROM productos
WHERE disponible = TRUE
ORDER BY precio ASC;
```
- Filtra solo productos disponibles (`disponibles = TRUE`)
- Ordena resultados de menor a mayor precio
##### Mostrar clientes por fecha de registro descendente
```sql
-- Ver los clientes más recientes primero

SELECT cliente_id, nombre, fecha_registro
FROM clientes
ORDER BY fecha_registro DESC;
```
- Ordena la lista de clientes del más nuevo (`fecha_registro` más reciente) al más antiguo.
##### Ordenar por múltiples criterios: ventas por región y monto
```sql
-- Obtener las ventas agrupadas por región y, dentro de cada región
-- las ventas más altas primero

SELECT region, venta_id, monto
FROM ventas
WHERE fecha_venta >= '2025-06-01'
ORDER BY region ASC, monto DESC;
```
- Filtra ventas de junio 2025
- Ordena primero por `region` alfabéticamente (A -> Z)
- Dentro de cada región, ordena por `monto` de mayor a menor
##### Paginación con `ORDER BY` y `LIMIT`/`OFFSET`
```sql
-- Mostrar la página 3 (20 registros por pagina) 
-- de productos ordenados por nombre

SELECT producto_id, nombre_producto
FROM productos
ORDER BY nombre_producto ASC
LIMIT 20 OFFSET 40; -- página 3: (3-1)*20 = 40
```
- Ordena todos los productos por nombre ascendente
- Devuelve 20 filas comenzando desde la fila 41 (`offset 40`), es decir, la página 3 en una paginación de 20 elementos por página.
##### Ordenar por una expresión: longitud del nombre de usuario
```sql
-- Quieres ver los usuarios con el nombre más largo primero

SELECT usuario_id, nombre, LENGTH(nombre) AS largo_nombre
FROM usuarios
ORDER BY LENGTH(nombre) DESC;
```
- Calcula la longitud de cada `nombre` usando `LENGTH(nombre)`
- Ordenar de mayor a menor longitud
- Útil, por ejemplo, para detectar nombres inusualmente lagos que podrían necesitar truncamiento en interfaces.