> [!info] HTTP in API Design (Roadmap SH)
> HTTP, o Protocolo de Transferencia de Hipertexto, es un componente fundamental del diseño de cualquier API. Es el protocolo utilizado para transmitir datos hipermedia en la web, como páginas web HTML o JSON desde una API web. Comprender HTTP es fundamental en el diseño de API, ya que proporciona la estructura sobre cómo deben construirse y gestionarse las solicitudes y respuestas. Dicta cómo se definen los puntos finales, cómo se deben transferir los datos y qué códigos de estado se deben utilizar para transmitir escenarios específicos. Una base sólida en los principios HTTP permite diseños de API más sólidos, eficientes y seguros.

### Definición 
HTTP es el protocolo de comunicación **cliente-servidor** que constituye la base para el intercambio de datos en la World Wide Web. Es el protocolo de **solicitud-respuesta** (`request-response`) que define cómo los clientes (como un navegador web o una aplicación móvil) solicitan recursos y cómo los servidores (que alojan los recursos) responden a esas solicitudes. Fundamentalmente, es el lenguaje que permite que un navegador "hable" con un servidor para cargar una página web o que una aplicación consuma una API.
### Conceptos Clave
- **Modelo Cliente-Servidor**: La comunicación siempre es iniciada por el cliente (quien solicita) hacia el servidor (quien responde). El servidor nunca inicia una comunicación con el cliente; solo responde a sus peticiones.
- **Ciclo de Solicitud-Respuesta (`Request-Response Cycle`)**: Es el flujo fundamental.
	1. El cliente abre una conexión TCP (o QUIC en HTTP/3) con el servidor
	2. El cliente envía un mensaje de solicitud HTTP (`HTTP Request`)
	3. El servidor procesa la solicitud
	4. El servidor envía un mensaje de respuesta HTTP (`HTTP Response`)
	5. La conexión se cierra (o se mantiene viva para futuras solicitudes en HTTP/1.1+)
- **`Stateless` (Sin estado)**: Cada solicitud HTTP es un evento independiente. El servidor no guarda ninguna información o contexto sobre solicitudes anteriores del mismo cliente. Si se necesita mantener un estado (como una sesión de usuario), debe gestionarse externamente, por ejemplo, usando `cookies` o `tokens` que el cliente debe enviar en cada solicitud.
- **Estructura del Mensaje HTTP**: Tanto las solicitudes como las respuestas comparten una estructura similar:
	1. **Línea de inicio (`Start-line`)**:
		- **Solicitud**: Contiene el **método HTTP** (ej. `GET`), la **URI** del recurso (ej. `/users/123`) y la **versión HTTP** (ej. `HTTP/1.1`)
		- **Respuesta**: Contiene la **versión HTTP**, un **código de estado** (ej. `200`) y un **texto de estado** (ej. `OK`).
	2. **Cabeceras (`Headers`)**: Pares clave-valor que proporcionan metadatos sobre la solicitud o respuesta (ej. `Content-Type: application/json`, `Authorization: Bearer ...`).
	3. **Línea en blanco**: Una línea vacía que separa las cabeceras del cuerpo.
	4. **Cuerpo (`Body`)**: Opcional. Contiene los datos de la solicitud (ej. un formulario JSON en solicitud `POST`) o el recurso solicitado en la respuesta (ej. el HTML de una página o los datos JSON de una API).
- **Métodos HTTP (Verbos)**: Indican la acción que el cliente desea realizar sobre el recurso. Los más comunes son:
	- `GET`: Recuperar datos de un recurso. Es seguro e idempotente.
	- `POST`: Enviar datos para crear un nuevo recurso. No es idempotente.
	- `PUT`: Reemplazar completamente un recurso existente. Es idempotente.
	- `PATCH`: Actualizar parcialmente un recurso existente. No es necesariamente idempotente.
	- `DELETE`: Eliminar un recurso. Es idempotente.
	- **Idempotente**: Una operación idempotente si realizarla una vez tiene el mismo efecto que realizarla múltiples veces.
- **Códigos de Estado HTTP (`Status Codes`)**: Indican el resultado de la solicitud. Se agrupan en clases:
	- `1xx` (Informativas): Solicitud recibida, continuando proceso
	- `2xx` (Éxito): La acción fue recibida, entendida y aceptada con éxito (ej. `200 OK`, `201 Created`).
	- `3xx` (Redirección): Se necesitan acciones adicionales para completar la solicitud (ej. `301 Moved Permanently`).
	- `4xx` (Error del Cliente): La solicitud tiene una sintaxis incorrecta o no puede ser cumplida (ej. `400 Bad Request`, `401 Unauthorized`, `404 Not Found`).
	- `5xx` (Error del Servidor): El servidor no pudo cumplir una solicitud aparentemente válida (ej. `500 Internal Server Error`).
### Ejemplos Prácticos
##### Solicitud HTTP (`POST`)
```http
POST /api/users HTTP/1.1
Host: api.example.com
Content-Type: application/json
Accept: application/json
User-Agent: MyCoolApp/1.0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

{
  "name": "Alex Smith",
  "email": "alex.smith@example.com"
}
```
- Línea de Inicio: `POST /api/users HTTP/1.1`
- Cabeceras: `Host`, `Content-Type`, `Accpet`, etc.
- Cuerpo: El objeto JSON con los datos del nuevo usuario
##### Respuesta HTTP
```http
HTTP/1.1 201 Created
Date: Fri, 07 Jun 2024 17:25:00 GMT
Content-Type: application/json
Content-Length: 95
Connection: keep-alive

{
  "id": "usr_12345",
  "name": "Alex Smith",
  "email": "alex.smith@example.com",
  "createdAt": "2024-06-07T17:25:00Z"
}
```
- Línea de Inicio: `HTTP/1.1 201 Created`
- Cabeceras: `Date`, `Content-Type`, etc.
- Cuerpo: El objeto JSON que representa al usuario recién creado, incluyendo su nuevo `ID`
### Notas
- **HTTP es la base de las APIs web**: Entender HTTP a fondo no es opcional, es el cimiento. Cuando diseñas una API REST, en realidad estás definiendo cómo usar los componentes de HTTP (URIs, métodos, códigos de estado, cabeceras) para exponer tu lógica de negocio.
- `Stateless` es una ventaja, no un error: La naturaleza sin estado de HTTP simplifica enormemente el diseño de los servidores. Les permite escalar horizontalmente con facilidad, ya que cualquier servidor puede atender cualquier solicitud sin necesidad de sincronizar sesiones complejas. El "estado" se delega al cliente o a una base de datos/caché compartida.