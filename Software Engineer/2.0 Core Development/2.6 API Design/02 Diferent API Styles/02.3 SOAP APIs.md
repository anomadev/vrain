## Definición
`SOAP` es un protocolo de mensajería estándar, basado en `XML`, diseñado para el intercambio de información estructurada en la implementación de servicios web. A diferencia de `REST` ([[02.1 RESTful APIs]]) (que es un estilo arquitectónico), `SOAP` es un protocolo estricto con reglas definidas que garantizan la seguridad, la atomicidad de las transacciones y la fiabilidad, lo que lo hace ideal para entornos empresariales complejos.

## Conceptos Clave
- **`XML Messaging`**: Utiliza exclusivamente `XML` para el formato de los mensajes, lo que permite una validación estricta mediante esquemas (`XSD`).
- **`WSDL (Web Services Description Language)`**: Es el "contrato" de la API ([[1.01 What are APIs]]). Un archivo `XML` que describe todos los métodos disponibles, sus parámetros de entrada y los formatos de salida.
- **`SOAP Envelope`**: El elemento raíz que identifica el documento `XML` como un mensaje `SOAP`.
- **`SOAP Header`**: Elemento opcional para metadatos como tokens de seguridad, `IDs` de transacción o información de enrutamiento.
- **`SOAP Body`**: Contiene los datos reales de la solicitud o respuesta (el "`payload`"). 
- **`SOAP Fault`**: Sección específica dentro del `Body` para el manejo y reporte de errores de forma estandarizada.
- **`WS-Security`**: Conjunto de extensiones que permiten aplicar seguridad a nivel de mensaje (cifrado y firma digital), más allá de la seguridad de la capa de transporte (`HTTPS`).
- **`ACID Compliance`**: Soporta transacciones atómicas, consistentes, aisladas y duraderas, crucial para sistemas financieros.

## Ejemplos Prácticos
##### SOAP Request Example (`XML`)
```xml
<?xml version="1.0"?>
<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" 
               xmlns:m="http://www.example.org/stock">
  <soap:Header>
    <m:AuthToken>ABC-123-XYZ</m:AuthToken>
  </soap:Header>
  <soap:Body>
    <m:GetStockPrice>
      <m:StockName>GOOG</m:StockName>
    </m:GetStockPrice>
  </soap:Body>
</soap:Envelope>
```
##### SOAP Fault Example (`Error handling`)
```xml
<soap:Fault>
   <soap:Code><soap:Value>soap:Sender</soap:Value></soap:Code>
   <soap:Reason><soap:Text>Invalid Stock Name</soap:Text></soap:Reason>
</soap:Fault>
```

## Analogía
Imagina que enviar un mensaje `SOAP` es como enviar un **Cheque Certificado por correo postal**.
- El **Cheque (`Data`)** va dentro de un **Sobre Oficial (`Envelop`)** con sellos de seguridad.
- El sobre tiene instrucciones clara de entrega (`Header`) y un sello de cera que garantiza que no ha sido abierto (`WS-Security`).
- Si el cheque rebota, el banco te devuelve un formulario de error oficial y estandarizado (`Fault`).
- A diferencia de un mensaje de texto rápido (`REST`), este proceso es más lento y pesado, pero tiene **validez legal y garantías** de que el dinero llegó exactamente como debía.

## Buenas Prácticas
- **`WSDL First Approach`**: Define siempre el contrato (`WSDL`) antes de codificar la lógica para asegurar la interoperabilidad entre diferentes plataformas.
- **Uso de `HTTPS`**: Aunque `SOAP` tiene seguridad a nivel de mensaje, siempre debe transportarse sobre túneles `SSL/TLS` para una protección integral.
- **Manejo de Errores con `Faults`**: Nunca devuelvas errores genéricos; utiliza los sub-elementos de `Fault` para proporcionar códigos de error que el cliente pueda procesar programáticamente.
- **Validación de Esquema**: Valida siempre los mensajes entrantes contra el `XSD` definido en el `WSDL` para evitar procesar datos malformados.

## Notas Personales
- `SOAP` no está muerto; vive en el "backend del backend" de bancos y aseguradoras.
- Es frustrante de depurar debido a la verbosidad del `XML`, pero su capacidad de auto-documentación mediante el `WSDL` es una ventaja enorme frente a `APIs REST` mal documentada.
- Si el proyecto requiere transacciones distribuidas complejas que deben ser infalibles, `SOAP` sigue siendo el rey, a pesar de su "peso".
